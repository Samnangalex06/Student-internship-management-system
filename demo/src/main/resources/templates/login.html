<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Upload Document</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link th:href="@{/css/app.css}" rel="stylesheet" />
  </head>

  <body class="app-shell">
    <div th:replace="fragments/student-nav :: studentNav"></div>

    <div class="container app-content">
      <div class="glass p-4">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h3 class="mb-1">Upload Document</h3>
            <div class="small-muted">PDF or DOCX only</div>
          </div>
          <span class="badge badge-soft">Student</span>
        </div>

        <hr class="border-light opacity-10 my-4" />

        <!-- Messages -->
        <div
          th:if="${success}"
          class="alert alert-success"
          th:text="${success}"
        ></div>
        <div
          th:if="${error}"
          class="alert alert-danger"
          th:text="${error}"
        ></div>

        <!-- Upload Form -->
        <form
          th:action="@{/documents/upload}"
          method="post"
          enctype="multipart/form-data"
        >
          <div class="mb-3">
            <label class="form-label">Select File</label>
            <input
              type="file"
              id="fileInput"
              name="file"
              class="form-control"
              accept=".pdf,.doc,.docx"
              required
            />

            <div class="small-muted mt-2">Allowed types: PDF, DOC, DOCX</div>
          </div>

          <!-- Preview -->
          <div id="filePreview" class="card-soft p-3 mb-3 d-none">
            <div><strong>File name:</strong> <span id="fileName"></span></div>
            <div><strong>File size:</strong> <span id="fileSize"></span></div>
            <div id="fileWarning" class="text-danger mt-1 d-none">
              Invalid file type selected.
            </div>
          </div>

          <button type="submit" class="btn btn-success px-4">Upload</button>

          <a th:href="@{/student/dashboard}" class="btn btn-outline-light ms-2">
            Cancel
          </a>
        </form>
      </div>
    </div>

    <!-- Simple Preview Script -->
    <script>
      const fileInput = document.getElementById("fileInput");
      const preview = document.getElementById("filePreview");
      const fileName = document.getElementById("fileName");
      const fileSize = document.getElementById("fileSize");
      const warning = document.getElementById("fileWarning");

      fileInput.addEventListener("change", function () {
        const file = this.files[0];
        if (!file) return;

        const allowed = ["pdf", "doc", "docx"];
        const ext = file.name.split(".").pop().toLowerCase();

        fileName.textContent = file.name;
        fileSize.textContent = (file.size / 1024).toFixed(2) + " KB";

        preview.classList.remove("d-none");

        if (!allowed.includes(ext)) {
          warning.classList.remove("d-none");
        } else {
          warning.classList.add("d-none");
        }
      });
    </script>
  </body>
</html>
